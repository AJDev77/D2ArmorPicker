<div id="cluster-container">
  <a class="returnbutton" color="primary" mat-raised-button routerLink="/v2/"> Return to D2ArmorPicker </a>
  <mat-card>
    <mat-card-title>
      About this page
    </mat-card-title>
    <mat-card-content>
      This page <i>can</i> help you to sort out your vault a bit.
      It takes all your armor entries and tries to sort them into {{clusterInformation.length}} clusters.
      It then gives you a DIM search query for each cluster.
      You can use this to look at similar rolls in your vault and to clean out some of them.
      <br>
      <br>
      Please note that it will cluster all armor for all characters.
      Make sure to use "is:titan", "is:warlock" or "is:hunter" in DIM.
      <br> <br>
      Please also note that this feature is new and may have some inaccuracy for some items.<br/>
      Also, this page only refreshes if you reload the whole page. I will change this soon-ish.<br/>
    </mat-card-content>

    <mat-card-title>
      How do I use this page?
    </mat-card-title>
    <mat-card-content>
      <ol>
        <li>Pick one of the clusters below.</li>
        <li>Copy the DIM search query and insert it in the search bar in DIM.</li>
        <li>
          If you want, add one of the following to the search query: "is:titan", "is:warlock", "is:hunter" (without " of
          course);<br>
          You can also use "not:masterwork", "not:exotic" or other filters.
        </li>
        <li>Look at all the armor. Just look at it. If you see duplicates, you can look at them and decide which ones to
          keep.
        </li>
      </ol>
    </mat-card-content>
  </mat-card>

  <ng-container *ngFor="let cluster of clusters; let idx = index">
    <mat-card *ngIf="cluster.length > 0">
      <mat-card-title>
        Cluster {{idx + 1}}
      </mat-card-title>
      <mat-card-content>
        <div>Cluster {{idx + 1}} contains a total of <b>{{cluster.length}} item(s)</b>.</div>
        <div>Average stats of this cluster:
          Total {{clusterInformation[idx].mean[0] | number: '1.0-0'}} with stats
          {{clusterInformation[idx].mean[1] | number: '1.0-0'}} /
          {{clusterInformation[idx].mean[2] | number: '1.0-0'}} /
          {{clusterInformation[idx].mean[3] | number: '1.0-0'}} /
          {{clusterInformation[idx].mean[4] | number: '1.0-0'}} /
          {{clusterInformation[idx].mean[5] | number: '1.0-0'}} /
          {{clusterInformation[idx].mean[6] | number: '1.0-0'}}
        </div>

        <button (click)="openSnackBar('Copied the DIM search query to your clipboard.')"
                [cdkCopyToClipboard]="getDIMStringForCluster(cluster)"
                color="primary"
                mat-raised-button
                matTooltip="Use this button to copy a DIM search query to your clip board. It allows you to search the given items in DIM.">
          Copy DIM query to clipboard
        </button>
        <mat-form-field appearance="fill" class="searchQueryField">
          <mat-label>DIM Search Query</mat-label>
          <input [value]="getDIMStringForCluster(cluster)" matInput readonly type="text">
        </mat-form-field>
        <hr>
      </mat-card-content>
    </mat-card>
  </ng-container>

  <a class="returnbutton" color="primary" mat-raised-button routerLink="/v2/"> Return to D2ArmorPicker </a>

</div>
